services:
  notebooklm-api:
    # 如果 GitHub Actions 构建完成，使用这个
    # image: ghcr.io/samuncleorange/notebooklm2api:latest

    # 如果本地构建，使用这个
    build: .
    image: notebooklm2api:local

    container_name: notebooklm-api
    ports:
      - "${PORT:-8000}:8000"
    environment:
      # 注意: 这里使用 ${VAR} 语法从 .env 文件读取
      # Docker Compose 会自动处理变量替换
      - NOTEBOOKLM_AUTH_JSON
      - NOTEBOOKLM_NOTEBOOK_ID
      - API_KEY
      - PORT=8000
      - HOST=0.0.0.0
    restart: unless-stopped
    healthcheck:
      test: [ "CMD", "python", "-c", "import httpx; httpx.get('http://localhost:8000/health', timeout=5.0)" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
